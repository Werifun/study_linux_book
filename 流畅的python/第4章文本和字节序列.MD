# 第 4 章　文本和字节序列 

Python 3 明确区分了人类可读的**文本字符串**和**原始的字节序列**。隐式地把字节序列转换成 Unicode 文本已成过去。本章将要讨论 **Unicode 字符串**、**二进制序列**，以及在二者之间转换时使用的编码。 

本章将讨论下述话题：

- 字符、码位和字节表述

- bytes、 bytearray 和 memoryview 等二进制序列的独特特性

- 全部 Unicode 和陈旧字符集的编解码器

- 避免和处理编码错误

- 处理文本文件的最佳实践

- 默认编码的陷阱和标准 I/O 的问题

- 规范化 Unicode 文本，进行安全的比较

- 规范化、大小写折叠和暴力移除音调符号的实用函数

- 使用 locale 模块和 PyUCA 库正确地排序 Unicode 文本

- Unicode 数据库中的字符元数据

- 能处理字符串和字节序列的双模式 API 

  


## 4.1　字符问题 

- 一些简单定义：
  - 字符串：一个字符串是一个序列
  - 字符：最佳定义是 Unicode 字符 
  - 字符的标识，即码位 ????。如，字母 A 的码位是 U+0041，欧元符号的码位是 U+20AC 
  - 字符的具体表述取决于所用的编码 。编码是在码位和字节序列之间转换时使用的算法。 
  - decode和encode
    - 可以把字节序列想成晦涩难懂的机器磁芯转储，把 Unicode 字符串想成“人类可读”的文本。那么，把字节序列变成人类可读的文本字符串就是**解码**，而把字符串变成用于存储或传输的字节序列就是**编码 **。



## 4.2　字节概要 

- bytes 或 bytearray 对象的各个元素是介于 0~255（含）之间的整
  数(具体有什么作用)

- bytes: 表示字节序列，是一个不可变的数据类型。

- bytearray: 表示字节数组，是一个可变的数据类型。

- bytes、bytearray、str的转换可以看书，或者去网上查找其他资料

- 虽然二进制序列其实是整数序列，但是它们的字面量表示法表明其中有ASCII 文本。因此，各个字节的值可能会使用下列**三种不同的方式**显示。

  - 可打印的 ASCII 范围内的字节（从空格到 ~），使用 ASCII 字符本身。

  - 制表符、换行符、回车符和 \ 对应的字节，使用转义序列\t、 \n、 \r 和 \\。

  - 其他字节的值，使用十六进制转义序列（例如， \x00 是空字节）。

   
  

### 结构体和内存视图
- struct(没用过，具体可以看书，粘贴书里一段)
- struct 模块提供了一些函数，把打包的字节序列转换成不同类型字段组成的元组，还有一些函数用于执行反向转换，把元组转换成打包的字节序列。 struct 模块能处理 bytes、 bytearray 和 memoryview对象。 



### 4.3　基本的编解码器 

utf-8之类的



## 4.4　了解编解码问题 



### 4.4.1　处理UnicodeEncodeError

- 文本转字符序列

### 4.4.2　处理UnicodeDecodeError 

- 字符序列转文本

### 4.4.3　使用预期之外的编码加载模块时抛出的SyntaxError 

- 在文件头添加: # encoding: utf-8



### 4.4.4　如何找出字节序列的编码 

- 统一字符编码侦测包 Chardet 

### 4.4.5 BOM：有用的鬼符 

- BOM，字节序标记(byte-order mark), eg.

  ```python
  >>> u16 = 'El Niño'.encode('utf_16')
  >>> u16
  b'\xff\xfeE\x00l\x00 \x00N\x00i\x00\xf1\x00o\x00'
  ```

  b'\xff\xfe'。这是 BOM ，指明编码时使用 Intel CPU 的小字节序 。



## 4.5　处理文本文件 

- “Unicode 三明治” 
  - 对输入来说，要尽早把输入（例如读取文件时）的字节序列解码成字符串。；
  - 对输出来说，则要尽量晚地把字符串编码成字节序列。 



## 4.6　为了正确比较而规范化Unicode字符串

应该就是把表现相同的unicode字符串对应的码位归一化，然后方便比较



## 4.7 Unicode文本排序 

- 比较的是码位
- 但是unicode排序比较奇怪，可以把locale.strxfrm 、等传入sorted中的key。



## 4.8 Unicode数据库 

- Unicode 标准提供了一个完整的数据库（许多格式化的文本文件），不
  仅包括码位与字符名称之间的映射，还有各个字符的元数据，以及字符
  之间的关系。 
- 好吧，里面的例子没有看懂，感觉就是说了re对unicode的支持并不是十分充分



## 4.9　支持字符串和字节序列的双模式API 

### 4.9.1　正则表达式中的字符串和字节序列



### 4.9.2	os函数中的字符串和字节序列

- os 模块中的所有函数、文件名或路径名参数既能使用字符串，也能使用字节序列。 

- sys.getfilesystemencoding()  、fsencode 、fsdecode、surrogateescape 



# 参考

[bytes和bytearray](<https://blog.csdn.net/littlehuang950620/article/details/81585294>)

